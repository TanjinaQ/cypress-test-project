name: Cypress Tests

on: [push, pull_request]

jobs:
  cypress-run:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Cache Node.js modules
      uses: actions/cache@v3
      with:
       path: ~/.npm
       key: ${{ runner.os }}-node-${{ hashFiles('package-lock.json') }}
         ${{ runner.os }}-node-

    - name: Cache Cypress binary
      uses: actions/cache@v3
      with:
       path: ~/.cache/Cypress
       key: ${{ runner.os }}-cypress-${{ hashFiles('package-lock.json') }}
       restore-keys: |
        ${{ runner.os }}-cypress-

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'

    - run: npm install
    - run: npx cypress run --record --key ${{ secrets.CYPRESS_RECORD_KEY }}
    - uses: actions/upload-artifact@v3
      with:
        name: Cypress Videos
        path: cypress/videos
